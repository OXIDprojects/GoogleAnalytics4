{% set gtmProduct = oView.getProduct() %}
{% set gtmCategory = gtmProduct.getCategory() %}
{% set gtmManufacturer = gtmProduct.getManufacturer() %}

{% block d3_ga4_view_item_block %}
    {% set doNotShow %}{% apply spaceless %}
        <script type="text/javascript">
            {% set d3_ga4_view_item %}{% apply spaceless %}
                dataLayer.push({"event": null, "eventLabel": null, "ecommerce": null});

                dataLayer.push({
                    'event': 'view_item',
                    'eventLabel':'Product View',
                    'ecommerce': {
                        'currency': '{{ currency.name }}',
                        'items': [
                            {
                            'item_oxid': '{{ gtmProduct.getFieldData("oxid") }}',
                            'item_name': '{{ gtmProduct.getFieldData('oxtitle')|raw }}',
                            'item_id': '{{ gtmProduct.getFieldData("oxartnum") }}',
                            'item_brand': '{% if gtmManufacturer %}{{ gtmManufacturer.getFieldData('oxtitle')|raw }}{% endif %}',
                            'item_variant': '{% if gtmProduct.getFieldData("oxvarselect") %}{{ gtmProduct.getFieldData("oxvarselect") }}{% endif %}',
                            {% if gtmCategory %}
                                'item_category':  '{{ gtmCategory.getSplitCategoryArray(0, true) }}',
                                'item_category2':'{{ gtmCategory.getSplitCategoryArray(1, true) }}',
                                'item_category3':'{{ gtmCategory.getSplitCategoryArray(2, true) }}',
                                'item_category4':'{{ gtmCategory.getSplitCategoryArray(3, true) }}',
                                'item_list_name':'{{ gtmCategory.getSplitCategoryArray() }}',
                            {% endif %}
                            {% set d3PriceObject = gtmProduct.getPrice() %}
                                'price': {{ d3PriceObject.getPrice() }}
                            }
                        ]
                        {% if oViewConf.d3GetModuleConfigParam('_blViewItemAddVariants') %}
                        ,'item_variants':
                            [
                                {% for oVariant in gtmProduct.getVariants() %}
                                {
                                    'item_name':    '{{ oVariant.getRawFieldData("oxtitle") }}',
                                    'item_id':      '{{ oVariant.getFieldData("oxartnum") }}',
                                    'item_brand': '{% if gtmManufacturer %}{{ gtmManufacturer.getFieldData('oxtitle')|raw }}{% endif %}',
                                    'item_variant': '{% if oVariant.getFieldData("oxvarselect") %}{{ oVariant.getFieldData("oxvarselect") }}{% endif %}',
                                    {% if gtmCategory %}
                                    'item_category':  '{{ gtmCategory.getSplitCategoryArray(0, true) }}',
                                    'item_category2':'{{ gtmCategory.getSplitCategoryArray(1, true) }}',
                                    'item_category3':'{{ gtmCategory.getSplitCategoryArray(2, true) }}',
                                    'item_category4':'{{ gtmCategory.getSplitCategoryArray(3, true) }}',
                                    'item_list_name':'{{ gtmCategory.getSplitCategoryArray() }}',
                                    {% endif %}
                                    {% set d3PriceObject = oVariant.getPrice() %}
                                    'price': {{ d3PriceObject.getPrice() }}
                                },
                                {% endfor %}
                            ]
                        {% endif %}
                    }{% if oViewConf.isDebugModeOn() %},
                        'debug_mode': 'true'
                    {% endif %}
                });
            {% endapply %}{% endset %}
        </script>
    {% endapply %}{% endset %}
    {{ script({ add: d3_ga4_view_item.__toString(), dynamic: __oxid_include_dynamic }) }}
{% endblock %}