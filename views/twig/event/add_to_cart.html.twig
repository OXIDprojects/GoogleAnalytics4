
{% if d3CmpBasket and d3CmpBasket.getAddToBasketDecision() and d3CmpBasket.d3GtmRequestedArticleLoadedByAnid() != "null" %}
  {% set oGtmProduct = d3CmpBasket.d3GtmRequestedArticleLoadedByAnid() %}
  {% set oGtmAmountArticlesAdded = d3CmpBasket.getD3GtmAddToCartAmountArticles() %}
  {# twig.block.parent #}
  {# variable $oGtmProduct is passed from parent tempalte #}
  {% set d3PriceObject = oGtmProduct.getPrice() %}
  {% set gtmCurrency = oView.getActCurrency() %}
  {% set gtmManufacturer = oGtmProduct.getManufacturer() %}
  {% set gtmCategory = oGtmProduct.getCategory() %}

  {% block d3_ga4_add_to_cart_list_block %}
    {% set d3_ga4_add_to_cart_listtpl %}
      {% apply spaceless %}
      dataLayer.push({"event": null, "eventLabel": null, "ecommerce": null});  /* Clear the previous ecommerce object. */

      {# ** Debug cases ** #}
      {# event.preventDefault(); #}

      let iArtQuantity = $("{{ htmlIdAmountOfArticles }}").val();
      let iArtQuantityAdded = {{ oGtmAmountArticlesAdded }};

      if(!iArtQuantity && (iArtQuantityAdded is same as(1)){
)
        iArtQuantity = 1;
      }else{
        iArtQuantity = iArtQuantityAdded;
      }

      dataLayer.push({
        'isAddToBasket': true,
        'event':'add_to_cart',
        'eventLabel': 'add_to_cart',
        'ecommerce': {
          'currency':   "{{ currency.name }}",
          'value':      iArtQuantity*{{ d3PriceObject.getPrice() }},
          'items':      [
            {
              'item_id':        '{{ oGtmProduct.getFieldData('oxartnum') }}',
              'item_name':      '{{ oGtmProduct.getFieldData('oxtitle')|raw }}',
              'price':          {{ d3PriceObject.getPrice() }},
              'item_brand':     '{% if gtmManufacturer %}{{ gtmManufacturer.getFieldData('oxtitle')|raw }}{% endif %}',
              'item_variant':   '{% if oGtmProduct.getFieldData('oxvarselect') %}{{ oGtmProduct.getFieldData('oxvarselect') }}{% endif %}',
              {% if gtmCategory %}
              'item_category':  '{{ gtmCategory.getSplitCategoryArray(0, true) }}',
              'item_category_2':'{{ gtmCategory.getSplitCategoryArray(1, true) }}',
              'item_category_3':'{{ gtmCategory.getSplitCategoryArray(2, true) }}',
              'item_category_4':'{{ gtmCategory.getSplitCategoryArray(3, true) }}',
              'item_list_name':'{{ gtmCategory.getSplitCategoryArray() }}',
              {% endif %}
              'quantity': iArtQuantity
            }
          ]
        }{% if oViewConf.isDebugModeOn() %},
        'debug_mode': 'true'
        {% endif %}
      });
      {% endapply %}
    {% endset %}
    {{ script({ add: d3_ga4_add_to_cart_listtpl.__toString(), dynamic: __oxid_include_dynamic }) }}
  {% endblock %}
{% endif %}